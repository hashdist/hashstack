extends: [cmake_package]

dependencies:
  build: [blas, lapack, mpi]

sources:
- url: http://www.netlib.org/scalapack/scalapack.tgz
  key: tar.gz:br2k5ltjb7s64tnxsjxutroqxnu44cpo

defaults:
  # lib/libscalapack.so contains hard-coded path
  relocatable: false

build_stages:
- name: configure
  when compiler == 'gcc':
      extra: ['-D CMAKE_Fortran_FLAGS_RELEASE:STRING="-O3 -fPIC -march=native -ffast-math -funroll-loops"',
              '-D BUILD_TESTING:BOOL=OFF',
              '-D BUILD_SHARED_LIBS:BOOL=ON',
              '-D LAPACK_LIBRARIES:STRING="${LAPACK_LIBRARY_NAME}"',
              '-D BLAS_LIBRARIES:STRING="${BLAS_LIBRARY_NAME}"',
              ]
  when compiler != 'gcc':
      extra: ['-D BUILD_TESTING:BOOL=OFF',
              '-D BUILD_SHARED_LIBS:BOOL=ON',
              '-D LAPACK_LIBRARIES:STRING="${LAPACK_LIBRARY_NAME}"',
              '-D BLAS_LIBRARIES:STRING="${BLAS_LIBRARY_NAME}"',
              ]
  build_in_source: true

- name: setup_builddir
  mode: override
  bash: |
